<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Quiz Buzzer </title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
<link href="https://fonts.googleapis.com/css?family=Montserrat:700,400&display=swap" rel="stylesheet" />
<style>
  :root {
    --main-bg: #262e46;
    --primary: #3b8bee;
    --accent: #ffe05b;
    --danger: #e94f37;
    --radius: 16px;
  }
  html, body {
    margin:0; padding:0; height:100%; font-family:'Montserrat', Arial, sans-serif;
    background: var(--main-bg); color: #fff;
    user-select:none;
  }
  .page {
    display: none; max-width: 720px; margin: 0 auto; padding: 28px 32px;
  }
  .show { display: block; }
  h1,h2,h3 { font-weight:700; margin-bottom: 24px; text-align:center; }
  input[type=text], input[type=password], input[type=email], input[type=file] {
    width: 100%; max-width: 420px; padding: 14px 18px; font-size: 1.2em;
    border-radius: var(--radius); border: none; margin: 12px auto 24px auto;
    background: #344365; color: #fff; box-sizing: border-box; text-align: center;
  }
  input::placeholder { color: #bac3e6; }
  button, .buzzer-btn {
    background: var(--primary);
    color: #fff;
    font-family: Montserrat;
    font-weight: 700;
    font-size: 1.3em;
    border: none;
    border-radius: 48px;
    padding: 18px 20px;
    cursor: pointer;
    box-shadow: 0 6px 13px #2554a180;
    user-select: none;
    transition: background 0.2s ease;
    text-align: center;
    min-width: 180px;
    max-width: 320px;
    margin: 18px auto;
    display: block;
  }
  button:hover:not(:disabled), .buzzer-btn:hover:not(:disabled) { background: var(--accent); color: #232323; }
  button:disabled, .buzzer-btn:disabled { background: #ddd; color: #999; cursor: not-allowed; box-shadow: none; }
  .buzzer-btn {
    background: var(--accent);
    color: #141c34;
    font-size: 4rem;
    font-weight: 900;
    padding: 48px 120px;
    border-radius: 90px;
    border: 8px solid #fff;
    box-shadow: 0 8px 32px #ffea6fcc;
    margin: 38px auto;
    min-width: 0; max-width: none;
    text-align: center;
  }
  .backbtn {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 1.3em;
    padding: 12px 40px;
    border-radius: 44px;
    background: #364063;
    color: white;
    border: none;
    cursor: pointer;
    box-shadow: 0 5px 16px #000a;
    user-select: none;
    z-index: 1100;
    transition: background .3s cubic-bezier(.4,2,.77,.52);
  }
  .backbtn:hover { background: var(--accent); color: #232323; }
  .scoreboard {
    max-width: 720px; margin: 30px auto;
    background: #222947; padding: 18px 28px;
    box-shadow: 0 2px 14px #0008; border-radius: 20px;
    color: #fff; overflow-x: auto;
  }
  table {
    width: 100%; border-collapse: collapse; color: #fff;
  }
  thead tr { background: var(--primary);}
  th, td { padding: 14px 10px; border: 1px solid #1a2138; text-align: center; }
  tbody tr:nth-child(odd) { background: #2a2f4b;}
  tbody tr:hover { background-color: #3b8bee90;}
</style>
</head>
<body>
<audio id="buzz-audio">
  <source src="https://cdn.pixabay.com/audio/2022/06/14/audio_123e37b08f.mp3" type="audio/mp3" />
</audio>
<button class="backbtn" id="backbtn" style="display:none;position:fixed;bottom:22px;left:50%;transform:translateX(-50%);" onclick="backButtonHandler()">‚Üê Back</button>
<div id="modal" style="position:fixed;top:20px;left:50%;transform:translateX(-50%);padding:16px 28px;background:#ffcf46cc;border-radius:16px;color:#232323;font-weight:700;display:none;user-select:none;z-index:9999"></div>

<!-- Sample: login & buzzer pages only -->
<div id="page-login" class="page show">
  <div class="center-box">
    <h1>Login Demo</h1>
    <input id="login-username" type="text" placeholder="Username" maxlength="24" autocomplete="off"/>
    <input id="login-password" type="password" placeholder="Password" maxlength="24"/>
    <button onclick="showPlayerPage()">Login</button>
  </div>
</div>
<div id="page-player" class="page">
  <div class="center-box">
    <h2>Quiz Buzzer</h2>
    <div style="color:#ffe05b;font-weight:700;font-size:1.4em;margin-bottom:10px;">
      Hello, <span id="pl-name"></span>!
    </div>
    <div><b>Game Code:</b> <span id="pl-room"></span></div>
    <div><b>Team:</b> <span id="pl-team"></span></div>
    <div id="player-question-text" style="font-size:2.5em;font-weight:700;margin:30px 0 15px 0;max-width:90vw;text-align:center;"></div>
    <button id="player-buzzer" class="buzzer-btn">BUZZ!</button>
    <div id="buzz-lock-msg"></div>
    <div class="scoreboard" id="player-scores"></div>
    <button style="margin-top:16px;" onclick="leaveGame()">Leave Game</button>
  </div>
</div>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBHvyZyATvhJ1pMx-kV-_ZXFwXPb54VspI",
  authDomain: "buzzer-a0d53.firebaseapp.com",
  databaseURL: "https://buzzer-a0d53-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "buzzer-a0d53",
  storageBucket: "buzzer-a0d53.appspot.com",
  messagingSenderId: "29031182202",
  appId: "1:29031182202:web:447d951b38be59b29270c3",
  measurementId: "G-NP0DMX7TKJ"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Dummy/DEMO vars
let myUser = "player1", myTeam = "Red", myPID = "pid123", gameID = "111111";
document.getElementById("pl-name").textContent = myUser;
document.getElementById("pl-room").textContent = gameID;
document.getElementById("pl-team").textContent = myTeam;
let buzzerDisabled = false, lastBuzz = 0;

// Show/hide page helpers
let pageHistory = [];
function showPage(id){
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("show"));
  document.getElementById(id).classList.add("show");
  document.getElementById("backbtn").style.display = (id==="page-login")?"none":"inline-block";
}
function navigateToPage(id){
  if(pageHistory.length===0 || pageHistory[pageHistory.length-1]!==id){
    pageHistory.push(id);
  }
  showPage(id);
}
function backButtonHandler(){
  if(pageHistory.length>1){
    pageHistory.pop();
    showPage(pageHistory[pageHistory.length-1]);
  }
}
function showPlayerPage(){ navigateToPage("page-player"); }

// Demo - buzzer listener and super-fast buzzer
function playBuzzSound(){
  const audio=document.getElementById("buzz-audio");
  audio.volume = 1.0;
  try {audio.currentTime = 0;}catch{}
  audio.play().catch(()=>{});
}
// Enable mouse and spacebar
function triggerBuzzer(){
  const now = performance.now();
  if(buzzerDisabled || (now-lastBuzz)<16) return; // ~60 times/second!
  lastBuzz = now;
  db.ref(`games/${gameID}/players/${myPID}`).update({ buzzed:true });
  db.ref(`games/${gameID}`).update({ buzzed:myPID });
  playBuzzSound();
}
document.getElementById("player-buzzer").onclick = triggerBuzzer;
window.addEventListener("keydown", function(ev){
  if(ev.code==="Space" || ev.keyCode===32){
    triggerBuzzer();
    ev.preventDefault();
  }
});

// Player leaves
function leaveGame(){
  db.ref(`games/${gameID}/players/${myPID}`).remove().then(()=>{
    db.ref(`games/${gameID}/buzzed`).remove();
    showPage("page-login");
  });
}

// Modal
function showModal(msg, t=1500){
  const modal=document.getElementById("modal");
  modal.textContent = msg;
  modal.style.display="block";
  setTimeout(()=>modal.style.display="none", t);
}

</script>
</body>
</html>
