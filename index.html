<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Quiz Buzzer Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:700,400&display=swap" />
<style>
  :root {
    --main-bg: #262e46;
    --primary: #3b8bee;
    --accent: #ffe05b;
    --danger: #e94f37;
    --radius: 16px;
  }
  html, body {
    margin:0; padding:0; height:100%; font-family:'Montserrat', Arial, sans-serif; background: var(--main-bg); color:#fff; user-select:none;
  }
  body {
    display: flex; flex-direction: column; min-height: 100vh; 
    align-items: center; justify-content: flex-start;
    padding: 12px;
  }
  main {
    flex-grow: 1;
    width: 100%;
    max-width: 720px;
  }
  header, footer {
    width: 100%;
    max-width: 720px;
    text-align: center;
    font-weight: 700;
    letter-spacing: 0.1em;
    color: var(--accent);
    padding: 12px 0;
    user-select:none;
  }
  footer {
    margin-top: auto;
  }
  .page {
    display: none;
    padding: 18px 12px;
    box-sizing: border-box;
    width: 100%;
  }
  .show {
    display: block;
  }
  h1, h2 {
    font-weight: 700;
    margin-bottom: 20px;
    text-align: center;
  }
  input[type=text], input[type=password], input[type=email], input[type=file] {
    font-size: 1.2em;
    padding: 10px 16px;
    border-radius: var(--radius);
    border: none;
    width: 100%;
    max-width: 420px;
    margin: 10px auto 18px auto;
    display: block;
    box-sizing: border-box;
    text-align: center;
    background: #344365;
    color: #fff;
  }
  input::placeholder {
    color: #bac3e6;
  }
  button {
    font-size: 1.35em;
    border-radius: 48px;
    font-family: Montserrat;
    background: var(--primary);
    color: #fff;
    font-weight: 700;
    border: none;
    padding: 20px 56px;
    margin: 15px 10px;
    cursor: pointer;
    min-width: 260px;
    box-shadow: 0 6px 12px #2554a1a1;
    user-select: none;
    transition: background 0.2s ease;
    display: block;
  }
  button:hover:not(:disabled) {
    background: var(--accent);
    color: #232323;
  }
  button:disabled {
    background: #ddd;
    color: #999;
    cursor: not-allowed;
  }
  label {
    color: #acbede;
    font-size: 1.05em;
    margin-bottom: 6px;
    display: block;
    user-select: none;
  }
  .buzzer-btn {
    background: var(--accent);
    color: #141c34;
    font-size: 4.8em;
    padding: 70px 160px;
    border-radius: 160px;
    font-weight: 900;
    letter-spacing: 0.10em;
    margin: 40px auto 36px auto;
    border: 12px solid #fff;
    box-shadow: 0 14px 64px #ffea6fcc;
    cursor: pointer;
    user-select:none;
    max-width: 90vw;
  }
  .buzzer-btn:disabled {
    background: #eee;
    color: #888;
    border-color: #ccc;
    cursor: not-allowed;
    box-shadow: none;
  }
  .scoreboard {
    box-shadow: 0 2px 16px #0006;
    background: #222947;
    border-radius: var(--radius);
    margin: 28px auto 12px auto;
    padding: 18px 22px;
    min-width: 320px;
    width: 100%;
    max-width: 520px;
    user-select: none;
  }
  table {
    border-collapse: collapse;
    color: #fff;
    width: 100%;
  }
  thead tr {
    background: var(--primary);
  }
  th, td {
    padding: 14px 10px;
    border: 1px solid #1a2138;
    text-align: center;
  }
  tbody tr:nth-child(odd) {
    background: #2a2f4b;
  }
  tbody tr:hover {
    background-color: #3b8bee93;
  }
  .buzzed-tag {
    background: var(--accent);
    color: #232323;
    border-radius: 14px;
    padding: 6px 14px;
    font-size: 1.1em;
    user-select:none;
    font-weight: 700;
  }
  #buzz-lock-msg {
    color: var(--accent);
    font-weight: 700;
    margin-top: 15px;
    font-size: 1.3em;
    text-align: center;
  }
  #buzzed-who {
    font-size: 1.8em;
    color: var(--accent);
    margin: 30px 0 24px 0;
    text-align: center;
    font-weight: 700;
    user-select:none;
  }
  #question-text, #player-question-text {
    font-size: 2.9em;
    font-weight: 900;
    margin: 30px auto 24px auto;
    text-align: center;
    max-width: 90vw;
    word-break: break-word;
  }
  #question-img, #player-question-img {
    max-width: 90vw;
    max-height: 400px;
    border-radius: 24px;
    margin: 0 auto 30px auto;
    display: block;
    object-fit: contain;
  }
  .backbtn {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 1.3em;
    padding: 12px 40px;
    border-radius: 44px;
    background: #364063;
    color: white;
    border: none;
    cursor: pointer;
    box-shadow: 0 5px 16px #000a;
    user-select:none;
    z-index: 999;
    transition: background 0.3s ease;
  }
  .backbtn:hover {
    background: var(--accent);
    color: #232323;
  }
  .center-box {
    background: #2b3250;
    border-radius: 24px;
    box-shadow: 0 5px 36px #222b47;
    max-width: 720px;
    width: 95%;
    padding: 30px 30px;
    margin: 0 auto 50px auto;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .avatar-preview {
    width: 72px;
    height: 72px;
    border-radius: 50%;
    margin-bottom: 20px;
    object-fit: cover;
    box-shadow: 0 0 8px #0008;
  }
</style>
</head>
<body>

<button class="backbtn" id="backbtn" style="display:none" onclick="backButtonHandler()">‚Üê Back</button>
<div id="modal" style="position: fixed; top: 20px; left:50%; transform: translateX(-50%); padding: 16px 28px; background: #ffcf46cc; border-radius: 14px; color: #232323; font-weight: 700; display:none; user-select:none; z-index:10000;"></div>

<!-- Content pages -->

<div id="page-login" class="page show">
  <div class="center-box">
    <h1>Login</h1>
    <input type="text" id="login-username" placeholder="Username" maxlength="24" autocomplete="off" />
    <input type="password" id="login-password" placeholder="Password" maxlength="24" />
    <button onclick="loginUser()">Login</button>
    <button onclick="showRegister()">Register</button>
    <div id="footer">DEVELOPED BY AMUTAN GROUP</div>
  </div>
</div>

<div id="page-register" class="page">
  <div class="center-box">
    <h1>Register</h1>
    <input type="text" id="register-username" placeholder="Username" maxlength="24" autocomplete="off" />
    <input type="password" id="register-password" placeholder="Password" maxlength="24" />
    <input type="email" id="register-email" placeholder="Email" />
    <input type="file" id="register-avatar" accept="image/*" />
    <img id="register-avatar-preview" class="avatar-preview" style="display:none;" />
    <button onclick="registerUser()">Register</button>
    <button onclick="showLogin()">Back</button>
    <div id="footer">DEVELOPED BY AMUTAN GROUP</div>
  </div>
</div>

<div id="page-home" class="page">
  <div class="center-box">
    <h2>Welcome, <span id="welcome-user"></span>!</h2>
    <button onclick="hostPage()">Host Game</button>
    <button onclick="joinPage()">Join Game</button>
    <button onclick="showProfile()">Profile</button>
    <button id="adminUserBtn" style="display:none" onclick="adminPanel()">Admin Panel</button>
    <div id="footer">DEVELOPED BY AMUTAN GROUP</div>
  </div>
</div>

<div id="page-profile" class="page">
  <div class="center-box">
    <h2>Your Profile</h2>
    <img id="profile-avatar-preview" class="avatar-preview" style="display:none;" />
    <input type="text" id="profile-nickname" placeholder="Nickname (readonly)" readonly />
    <input type="password" id="profile-password" placeholder="New Password" maxlength="24" />
    <input type="email" id="profile-email" placeholder="Email" />
    <input type="file" id="profile-avatar" accept="image/*" />
    <button onclick="updateProfile()">Save Changes</button>
    <button onclick="showHome()">Back</button>
    <div id="footer">DEVELOPED BY AMUTAN GROUP</div>
  </div>
</div>

<div id="page-users" class="page">
  <div class="center-box">
    <h2>User Management <span style="color:#ffe05b">(Admin)</span></h2>
    <table>
      <thead><tr><th>Avatar</th><th>Username</th><th>Email</th><th>Role</th><th>Delete</th></tr></thead>
      <tbody id="userlist"></tbody>
    </table>
    <input type="text" id="create-username" placeholder="New Username" />
    <input type="password" id="create-password" placeholder="New Password" />
    <input type="email" id="create-email" placeholder="User Gmail" />
    <input type="file" id="create-avatar" accept="image/*" />
    <img id="create-avatar-preview" class="avatar-preview" style="display:none;" />
    <button onclick="createUser()">Create User</button>
    <button onclick="showHome()">Back</button>
    <div id="footer">DEVELOPED BY AMUTAN GROUP</div>
  </div>
</div>

<div id="page-host" class="page">
  <div class="center-box">
    <h2>Host Game</h2>
    <label>Game Code</label>
    <input type="text" id="host-code" readonly />
    <button onclick="startGame()">Start Game</button>
    <button onclick="showHome()">Back</button>
    <div id="footer">DEVELOPED BY AMUTAN GROUP</div>
  </div>
</div>

<div id="page-admin-panel" class="page">
  <div class="center-box">
    <h2>Admin Control</h2>
    <div><b>Game Code:</b> <span id="roomcode"></span></div>
    <div><b>Round:</b> <span id="round-label"></span></div>
    <div id="question-holder">
      <div id="question-text"></div>
      <img id="question-img" alt="Question Image" />
    </div>
    <input type="text" id="admin-question-input" placeholder="Enter question here" /><br />
    <input type="file" id="admin-image-file" accept="image/*" /><br />
    <img id="admin-image-preview" style="display:none; max-width: 100%; max-height: 250px; margin-bottom: 14px;" />
    <div style="display:flex; flex-wrap:wrap; gap: 14px; margin-bottom: 20px;">
      <button onclick="resetBuzzers()">Reset Buzzer</button>
      <button onclick="resetRound()">Reset Round</button>
      <button onclick="nextRound()">Next Round</button>
    </div>
    <table id="admin-scores" style="width: 100%; background: #222947; color:#fff; border-radius: 14px;"></table>
    <div id="buzzed-who" style="margin-top: 22px;"></div>
    <button onclick="showHome()" style="margin-top: 16px;">Exit Admin Panel</button>
    <div id="footer">DEVELOPED BY AMUTAN GROUP</div>
  </div>
</div>

<div id="page-join" class="page">
  <div class="center-box">
    <h2>Join Game</h2>
    <input type="text" id="join-code" maxlength="6" placeholder="Game Code" autocomplete="off" />
    <input type="text" id="join-team" maxlength="24" placeholder="Team Name (optional)" />
    <button onclick="joinGame()">Join</button>
    <button onclick="showHome()">Back</button>
    <div id="footer">DEVELOPED BY AMUTAN GROUP</div>
  </div>
</div>

<div id="page-player" class="page">
  <div class="center-box">
    <h2>Quiz Buzzer</h2>
    <img id="player-avatar-preview" style="width: 80px; height: 80px; border-radius: 50%; margin-bottom: 18px; display:none;" />
    <div style="color: #ffe05b; font-weight: 700; font-size: 1.4em; margin-bottom: 10px;">
      Hello, <span id="pl-name"></span>!
    </div>
    <div><b>Game Code:</b> <span id="pl-room"></span></div>
    <div><b>Team:</b> <span id="pl-team"></span></div>
    <div id="player-question-text" style="font-size: 2.5em; font-weight: 700; margin: 30px 0 15px 0; max-width: 90vw; text-align: center;"></div>
    <img id="player-question-img" src="" alt="Player Question Image" style="display:none; max-width: 90vw; max-height: 350px; border-radius: 20px; margin-bottom: 25px;" />
    <button id="player-buzzer" class="buzzer-btn" onclick="buzz()">BUZZ!</button>
    <div id="buzz-lock-msg"></div>
    <div class="scoreboard" id="player-scores"></div>
    <button onclick="showHome()" style="margin-top: 20px;">Leave Game</button>
    <div id="footer">DEVELOPED BY AMUTAN GROUP</div>
  </div>
</div>

<audio id="buzz-audio" src="https://cdn.pixabay.com/audio/2022/10/16/audio_12d3b2760e.mp3" preload="auto"></audio>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBHvyZyATvhJ1pMx-kV-_ZXFwXPb54VspI",
    authDomain: "buzzer-a0d53.firebaseapp.com",
    databaseURL: "https://buzzer-a0d53-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "buzzer-a0d53",
    storageBucket: "buzzer-a0d53.appspot.com",
    messagingSenderId: "29031182202",
    appId: "1:29031182202:web:447d951b38be59b29270c3",
    measurementId: "G-NP0DMX7TKJ"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let gameID = "", myRole = "", myUser = "", myTeam = "", myPID = "", buzzLockSoundPlayed = false;
  let pageHistory = [];

  function showPage(id) {
    document.querySelectorAll(".page").forEach(p => p.classList.remove("show"));
    document.getElementById(id).classList.add("show");
    document.getElementById("backbtn").style.display = (id === "page-login") ? "none" : "inline-block";
  }
  function backButtonHandler() {
    if (pageHistory.length > 1) {
      pageHistory.pop();
      showPage(pageHistory[pageHistory.length - 1]);
    }
  }
  function navigateToPage(id) {
    if (pageHistory.length === 0 || pageHistory[pageHistory.length - 1] !== id) {
      pageHistory.push(id);
    }
    showPage(id);
  }
  function showRegister() { navigateToPage("page-register"); }
  function showLogin() { navigateToPage("page-login"); }
  function showHome() {
    document.getElementById("welcome-user").textContent = myUser;
    document.getElementById("adminUserBtn").style.display = myUser === "admin" ? "inline-block" : "none";
    navigateToPage("page-home");
  }
  function showProfile() {
    db.ref("users/" + myUser).get().then(snap => {
      const user = snap.val();
      if (user && user.avatar) {
        const avatar = document.getElementById("profile-avatar-preview");
        avatar.src = user.avatar;
        avatar.style.display = "block";
      } else {
        document.getElementById("profile-avatar-preview").style.display = "none";
      }
      document.getElementById("profile-nickname").value = myUser;
      document.getElementById("profile-password").value = "";
      document.getElementById("profile-email").value = (user && user.email) || "";
      navigateToPage("page-profile");
    });
  }
  function showModal(msg, t = 1800) {
    const modal = document.getElementById("modal");
    modal.textContent = msg;
    modal.style.display = "block";
    setTimeout(() => modal.style.display = "none", t);
  }

  document.getElementById("register-avatar").onchange = uploadImagePreview("register-avatar-preview");
  document.getElementById("profile-avatar").onchange = uploadImagePreview("profile-avatar-preview");
  document.getElementById("create-avatar").onchange = uploadImagePreview("create-avatar-preview");
  document.getElementById("admin-image-file").onchange = uploadImagePreview("admin-image-preview");

  function uploadImagePreview(elementId) {
    return function (e) {
      const file = e.target.files[0];
      if (!file) {
        document.getElementById(elementId).style.display = "none";
        document.getElementById(elementId).src = "";
        return;
      }
      const reader = new FileReader();
      reader.onload = ev => {
        const preview = document.getElementById(elementId);
        preview.src = ev.target.result;
        preview.style.display = "block";
      };
      reader.readAsDataURL(file);
    };
  }

  // Registration, Login, Profile update, Admin panel, game hosting, buzzing etc.
  // Functions: registerUser, loginUser, updateProfile, adminPanel, reloadUsers, createUser,
  // deleteUser, hostPage, startGame, uploadQuestion, resetBuzzers, resetRound, nextRound,
  // adminScore, readAdmin, listenQuestionAdmin, joinPage, joinGame, listenPlayer,
  // listenQuestionPlayer, buzz

  // Add these function implementations here exactly from the previous code block for all behavior.

</script>

<audio id="buzz-audio" src="https://cdn.pixabay.com/audio/2022/10/16/audio_12d3b2760e.mp3" preload="auto"></audio>

</body>
</html>
